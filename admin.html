<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Administración • Abuela Perla</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- (opcional) mata SW en localhost para evitar cacheos -->
  <script>
  (function killSWInLocal(){
    if (!('serviceWorker' in navigator)) return;
    var isLocal = /^(localhost|127\.0\.0\.1)$/.test(location.hostname);
    if (!isLocal) return;
    navigator.serviceWorker.getRegistrations().then(rs => Promise.all(rs.map(r => r.unregister()))).catch(()=>{});
    if (window.caches && caches.keys) { caches.keys().then(keys => Promise.all(keys.map(k => caches.delete(k)))).catch(()=>{}); }
    navigator.serviceWorker.getRegistration && navigator.serviceWorker.getRegistration().then(reg=>{
      try{ reg && reg.active && reg.active.postMessage({ type:'AP_KILL_ME' }); }catch(_){}
    });
  })();
  </script>
</head>
<body class="ap-admin">
  <header class="ap-topbar">
    <a class="ap-admin-link" href="index.html">← Volver</a>
    <h1 class="ap-brand">Administración</h1>
    <span></span>
  </header>

  <main class="ap-admin__main">
    <section class="ap-admin__intro">
      Administrá productos y configuración. Iniciá sesión si te lo pide.
    </section>

    <!-- Toolbar: filtros y acciones -->
    <div class="ap-admin__toolbar">
      <div class="ap-toolbar__group">
        <select id="admCatFilter" class="ap-input">
          <option value="">Todas las categorías</option>
        </select>
        <input id="admSearch" class="ap-input" placeholder="Buscar por id, nombre, descripción o sabores…" />
      </div>
      <div class="ap-toolbar__actions">
        <button id="admNew" class="ap-btn ap-btn--primary"><span class="ap-ico">＋</span>Nuevo producto</button>
      </div>
    </div>

    <div id="admHint" class="ap-admin__hint"></div>

    <!-- Tabla de productos -->
    <div class="ap-table-wrap">
      <table class="ap-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Categoría</th>
            <th>Producto</th>
            <th>Sabores sin stock</th>
            <th>Precio</th>
            <th>Visible</th>
            <th>Imagen</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="adminRows"></tbody>
      </table>
    </div>

    <!-- Configuración -->
    <section style="margin-top:1rem" class="ap-admin__intro">
      <h3 style="margin:.2rem 0 .6rem 0">Configuración</h3>

      <form id="cfgForm" class="ap-grid-2">
        <!-- Costos de envío -->
        <label>Envío Diamante
          <input type="number" name="envio_diamante" class="ap-input" min="0" step="1" />
        </label>
        <label>Envío Strobel
          <input type="number" name="envio_strobel" class="ap-input" min="0" step="1" />
        </label>
        <label>Retiro (costo)
          <input type="number" name="envio_retiro" class="ap-input" min="0" step="1" />
        </label>
        <div></div>

        <!-- Transferencia -->
        <label class="full">Alias transferencia
          <input name="transfer_alias" class="ap-input" />
        </label>
        <label>Titular
          <input name="transfer_titular" class="ap-input" />
        </label>
        <label>Comprobantes (tel)
          <input name="transfer_compa" class="ap-input" />
        </label>

        <!-- ============================== -->
        <!-- Horarios y estado de atención -->
        <!-- ============================== -->
        <div class="full" style="margin-top:1rem">
          <hr style="border-color:#2a2a2a; opacity:.6">
        </div>
        <h4 class="full" style="margin:.3rem 0 .2rem">Horarios y estado de atención</h4>

        <label>Hora de apertura
          <input type="time" name="hours_open" class="ap-input" />
        </label>
        <label>Hora de cierre
          <input type="time" name="hours_close" class="ap-input" />
        </label>

        <div class="full">
          <div style="margin:.4rem 0 .2rem 0; font-weight:600">Días que abrimos</div>
          <div style="display:flex; flex-wrap:wrap; gap:.5rem;">
            <label class="ap-check"><input type="checkbox" name="hours_day" value="0"> Dom</label>
            <label class="ap-check"><input type="checkbox" name="hours_day" value="1"> Lun</label>
            <label class="ap-check"><input type="checkbox" name="hours_day" value="2"> Mar</label>
            <label class="ap-check"><input type="checkbox" name="hours_day" value="3"> Mié</label>
            <label class="ap-check"><input type="checkbox" name="hours_day" value="4"> Jue</label>
            <label class="ap-check"><input type="checkbox" name="hours_day" value="5"> Vie</label>
            <label class="ap-check"><input type="checkbox" name="hours_day" value="6"> Sáb</label>
          </div>
          <small style="opacity:.8">El estado “Estamos atendiendo / Cerrado” se calcula con estos días + horarios.</small>
        </div>

        <label class="full">Cierres puntuales (uno por línea)
          <textarea name="hours_special" class="ap-input" rows="4" placeholder="Ejemplos:
2025-05-25 | Cerrado por feriado
2025-06-08 | Cerrado por mantenimiento
2025-07-15 | Cerrado por duelo"></textarea>
        </label>

        <label>Modo de estado
          <select name="hours_manual_mode" class="ap-input">
            <option value="auto">Automático (según horarios)</option>
            <option value="open">Forzar ABIERTO</option>
            <option value="closed">Forzar CERRADO</option>
          </select>
        </label>
        <label>Mensaje (opcional)
          <input name="hours_manual_msg" class="ap-input" placeholder="Ej.: Cerrado por feriado" />
        </label>

        <div class="full" style="display:flex; gap:.5rem; justify-content:flex-end; margin-top:.6rem">
          <button type="button" id="cfgReload" class="ap-btn">Recargar</button>
          <button type="submit" class="ap-btn ap-btn--primary">Guardar</button>
        </div>
      </form>
    </section>
  </main>

  <!-- JS (misma versión que el resto) -->
  <script src="app.js?v=7"></script>
</body>
</html>
